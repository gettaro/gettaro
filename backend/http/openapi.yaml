openapi: 3.0.3
info:
  title: Engineering Insights API
  version: 1.0.0
  description: API for managing users, orgs, integrations, and engineering metrics.

servers:
  - url: http://localhost:8080/api

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        email: { type: string }
        is_active: { type: boolean }
        status: { type: string }
        titleId: { type: string }
        organizationId: { type: string }

    AuthProvider:
      type: object
      properties:
        id: { type: string }
        provider: { type: string }
        providerId: { type: string }

    Team:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        description: { type: string }
        type: 
          type: string
          enum: [squad, chapter, tribe, guild]
          nullable: true
        organization_id: { type: string }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
        members:
          type: array
          items:
            type: object
            properties:
              id: { type: string }
              member_id: { type: string }
              created_at: { type: string, format: date-time }
              updated_at: { type: string, format: date-time }

    Organization:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        slug: { type: string }
        isOwner: { type: boolean }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    OrganizationMember:
      type: object
      properties:
        id: { type: string }
        userId: { type: string }
        email: { type: string }
        username: { type: string }
        organizationId: { type: string }
        isOwner: { type: boolean }
        titleId: { type: string, format: uuid, nullable: true }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    Title:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        organizationId: { type: string, format: uuid }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    CreateTitleRequest:
      type: object
      properties:
        name: { type: string }
      required:
        - name

    UpdateTitleRequest:
      type: object
      properties:
        name: { type: string }
      required:
        - name

    UpdateOrganizationMemberRequest:
      type: object
      properties:
        username: { type: string }
        titleId: { type: string, format: uuid }
        sourceControlAccountId: { type: string, format: uuid }
      required:
        - username
        - titleId
        - sourceControlAccountId

    IntegrationProvider:
      type: string
      enum: [github]

    IntegrationConfig:
      type: object
      properties:
        id: { type: string }
        organizationId: { type: string }
        providerName: { type: string, enum: [github] }
        providerType: { type: string, enum: [SourceControl, ProjectManagement] }
        encryptedToken: { type: string }
        metadata: { type: object }
        lastSyncedAt: { type: string, format: date-time }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    CreateIntegrationConfigRequest:
      type: object
      properties:
        providerName: { type: string, enum: [github] }
        token: { type: string }
        metadata: { type: object }
      required:
        - providerName
        - token

    UpdateIntegrationConfigRequest:
      type: object
      properties:
        token: { type: string }
        metadata: { type: object }

    ListOrganizationPullRequestsResponse:
      type: object
      properties:
        pull_requests:
          type: array
          items:
            $ref: "#/components/schemas/PullRequest"

    PullRequest:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        url:
          type: string
        status:
          type: string
          enum: [open, closed, merged]
        created_at:
          type: string
          format: date-time
        merged_at:
          type: string
          format: date-time
        comments:
          type: integer
        review_comments:
          type: integer
        additions:
          type: integer
        deletions:
          type: integer
        changed_files:
          type: integer
        repository_name:
          type: string
        author:
          $ref: "#/components/schemas/PullRequestAuthor"
          nullable: true
          description: Author/member information for the pull request

    PullRequestAuthor:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Member ID
        username:
          type: string
          description: Member username
        email:
          type: string
          description: Member email
      description: Author/member information for a pull request

    PullRequestMetrics:
      type: object
      properties:
        merged_prs_count:
          type: integer
        open_prs_count:
          type: integer
        mean_publish_to_merge_time:
          type: number
          format: float
        mean_time_to_first_review:
          type: number
          format: float

    SourceControlAccount:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
          nullable: true
        organizationId:
          type: string
          format: uuid
          nullable: true
        providerName:
          type: string
        providerId:
          type: string
        username:
          type: string
        lastSyncedAt:
          type: string
          format: date-time
          nullable: true

    ListOrganizationSourceControlAccountsResponse:
      type: object
      properties:
        source_control_accounts:
          type: array
          items:
            $ref: "#/components/schemas/SourceControlAccount"

    GetMemberActivityResponse:
      type: object
      properties:
        activities:
          type: array
          items:
            $ref: "#/components/schemas/MemberActivity"

    GetMemberMetricsResponse:
      type: object
      properties:
        snapshot_metrics:
          type: array
          items:
            $ref: "#/components/schemas/SnapshotCategory"
        graph_metrics:
          type: array
          items:
            $ref: "#/components/schemas/GraphCategory"

    OrganizationMetricsResponse:
      type: object
      description: Organization-level metrics with optional team breakdown
      allOf:
        - $ref: "#/components/schemas/GetMemberMetricsResponse"
      properties:
        teams_breakdown:
          type: array
          items:
            $ref: "#/components/schemas/TeamMetricsBreakdown"
          description: Optional breakdown of metrics by team (only included when teams are specified)

    TeamMetricsBreakdown:
      type: object
      description: Metrics breakdown for a specific team
      properties:
        team_id:
          type: string
          format: uuid
          description: Team ID
        team_name:
          type: string
          description: Team name
        snapshot_metrics:
          type: array
          items:
            $ref: "#/components/schemas/SnapshotCategory"
          description: Snapshot metrics for this team
        graph_metrics:
          type: array
          items:
            $ref: "#/components/schemas/GraphCategory"
          description: Graph metrics for this team

    SnapshotCategory:
      type: object
      properties:
        category:
          $ref: "#/components/schemas/MetricRuleCategory"
        metrics:
          type: array
          items:
            $ref: "#/components/schemas/SnapshotMetric"

    SnapshotMetric:
      type: object
      properties:
        label:
          type: string
          description: Metric label (e.g., "Merged PRs", "LoC Added")
        description:
          type: string
          description: Metric description
        value:
          type: number
          format: float
          description: Member's metric value
        peers_value:
          type: number
          format: float
          description: Average peer metric value for comparison
        unit:
          type: string
          description: Unit of measurement (e.g., "count", "seconds")
          example: "count"
        icon_identifier:
          type: string
          description: Icon identifier for the metric
        icon_color:
          type: string
          description: Icon color for the metric

    GraphCategory:
      type: object
      properties:
        category:
          $ref: "#/components/schemas/MetricRuleCategory"
        metrics:
          type: array
          items:
            $ref: "#/components/schemas/GraphMetric"

    GraphMetric:
      type: object
      properties:
        label:
          type: string
          description: Metric label for the graph
        type:
          type: string
          enum: [timeseries]
          description: Type of graph visualization
        category:
          type: string
          description: Category name
        unit:
          type: string
          description: Unit of measurement (e.g., "count", "seconds")
          example: "count"
        time_series:
          type: array
          items:
            $ref: "#/components/schemas/TimeSeriesEntry"

    MetricRuleCategory:
      type: object
      properties:
        name:
          type: string
          description: Category name (e.g., "Activity", "Efficiency", "Collaboration")
        priority:
          type: integer
          description: Display priority (lower numbers shown first)

    TimeSeriesEntry:
      type: object
      properties:
        date:
          type: string
          format: date
          description: Date for the time series entry
        data:
          type: array
          items:
            $ref: "#/components/schemas/TimeSeriesDataPoint"

    TimeSeriesDataPoint:
      type: object
      properties:
        key:
          type: string
          description: Data series key (e.g., "Merged PRs", "Peers merged PRs")
        value:
          type: number
          format: float
          description: Data point value

    MemberActivity:
      type: object
      properties:
        id:
          type: string
          format: uuid
        type:
          type: string
          enum: [pull_request, pr_review, pr_comment]
          description: Type of activity
        title:
          type: string
          description: Title or main content of the activity
        description:
          type: string
          nullable: true
          description: Optional description of the activity
        url:
          type: string
          nullable: true
          description: URL to the activity (for pull requests)
        repository:
          type: string
          nullable: true
          description: Repository name where the activity occurred
        createdAt:
          type: string
          format: date-time
          description: When the activity was created
        metadata:
          type: object
          nullable: true
          description: Additional metadata about the activity
        authorUsername:
          type: string
          nullable: true
          description: Username of the author for pull requests
        prTitle:
          type: string
          nullable: true
          description: For comments/reviews, the title of the PR being commented on
        prAuthorUsername:
          type: string
          nullable: true
          description: For comments/reviews, the username of the PR author

    GetMemberMetricsResponse:
      type: object
      properties:
        merged_prs_count:
          type: integer
        open_prs_count:
          type: integer
        mean_publish_to_merge_time:
          type: number
          format: float
        mean_time_to_first_review:
          type: number
          format: float

paths:
  /users:
    get:
      summary: Get all users
      description: Returns a list of all users. Only accessible by admins or org managers.
      responses:
        "200":
          description: List of users
      security:
        - bearerAuth: []

    post:
      summary: Create a new user
      description: Only system admins can create users manually. Typically users register via auth.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/User"
      responses:
        "201":
          description: Created user
      security:
        - bearerAuth: []

  /users/me:
    get:
      summary: Get current user
      description: Returns the current user's information based on their JWT token. This endpoint is used to get the authenticated user's profile information.
      responses:
        "200":
          description: Current user details
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized - Invalid or missing JWT token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "unauthorized"
        "404":
          description: User not found - The user associated with the JWT token was not found in the database
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "user not found"
      security:
        - bearerAuth: []

  /users/{id}:
    get:
      summary: Get user by ID
      description: Get details about a specific user.
      parameters:
        - in: path
          name: id
          schema: { type: string }
      responses:
        "200":
          description: User detail
      security:
        - bearerAuth: []

    put:
      summary: Update user
      description: Update a user profile (e.g., title, status). Admin-only.
      parameters:
        - in: path
          name: id
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/User"
      responses:
        "200":
          description: Updated user
      security:
        - bearerAuth: []

    delete:
      summary: Delete user
      description: Soft delete or archive a user account. Admin-only.
      parameters:
        - in: path
          name: id
          schema: { type: string }
      responses:
        "204":
          description: Deleted
      security:
        - bearerAuth: []

  /organizations:
    post:
      summary: Create an organization
      description: Creates a new organization and sets the current user as its owner.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                slug: { type: string }
              required:
                - name
                - slug
      responses:
        "201":
          description: Organization created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Organization"
      security:
        - bearerAuth: []

    get:
      summary: List user's organizations
      description: Returns a list of organizations the current user is part of, including ownership information.
      responses:
        "200":
          description: List of organizations
          content:
            application/json:
              schema:
                type: object
                properties:
                  organizations:
                    type: array
                    items:
                      $ref: "#/components/schemas/Organization"
      security:
        - bearerAuth: []

  /organizations/{id}:
    get:
      summary: Get organization by ID
      description: Returns details about a specific organization.
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
      responses:
        "200":
          description: Organization details
          content:
            application/json:
              schema:
                type: object
                properties:
                  organization:
                    $ref: "#/components/schemas/Organization"
      security:
        - bearerAuth: []

    put:
      summary: Update organization
      description: Updates an existing organization. Only organization owners can update.
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                slug: { type: string }
      responses:
        "200":
          description: Updated organization
          content:
            application/json:
              schema:
                type: object
                properties:
                  organization:
                    $ref: "#/components/schemas/Organization"
      security:
        - bearerAuth: []

    delete:
      summary: Delete organization
      description: Deletes an organization. Only organization owners can delete.
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
      responses:
        "204":
          description: Organization deleted
      security:
        - bearerAuth: []

  /organizations/{id}/members:
    get:
      summary: List organization members
      description: Returns a list of all members in an organization.
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
      responses:
        "200":
          description: List of organization members
          content:
            application/json:
              schema:
                type: object
                properties:
                  members:
                    type: array
                    items:
                      $ref: "#/components/schemas/OrganizationMember"
      security:
        - bearerAuth: []

    post:
      summary: Add organization member
      description: Adds a user as a member to an organization. Only organization owners can add members.
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email: { type: string }
                username: { type: string }
                titleId: { type: string, format: uuid }
                sourceControlAccountId: { type: string, format: uuid }
              required:
                - email
                - username
                - titleId
                - sourceControlAccountId
      responses:
        "201":
          description: Member added
        "400":
          description: Bad request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - User is not an organization owner
        "500":
          description: Internal server error
      security:
        - bearerAuth: []

  /organizations/{id}/members/{memberId}:
    put:
      summary: Update organization member
      description: Updates a member's details in an organization. Only organization owners can update members. Email cannot be updated.
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
          description: Organization ID
        - in: path
          name: memberId
          schema: { type: string }
          required: true
          description: Member ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateOrganizationMemberRequest"
      responses:
        "200":
          description: Member updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Member updated successfully"
        "400":
          description: Bad request - Invalid request body or missing parameters
        "401":
          description: Unauthorized - User is not authenticated
        "403":
          description: Forbidden - User is not an organization owner
        "404":
          description: Not found - Member, title, or source control account not found
        "500":
          description: Internal server error
      security:
        - bearerAuth: []

    delete:
      summary: Remove organization member
      description: Removes a member from an organization. Only organization owners can remove members.
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
        - in: path
          name: memberId
          schema: { type: string }
          required: true
      responses:
        "204":
          description: Member removed
      security:
        - bearerAuth: []

  /organizations/{id}/titles:
    post:
      summary: Create title
      description: Creates a new title for an organization. Only organization owners can create titles.
      parameters:
        - in: path
          name: id
          schema: { type: string, format: uuid }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTitleRequest"
      responses:
        "201":
          description: Title created
          content:
            application/json:
              schema:
                type: object
                properties:
                  title:
                    $ref: "#/components/schemas/Title"
        "400":
          description: Bad request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - User is not an organization owner
        "500":
          description: Internal server error
      security:
        - bearerAuth: []

    get:
      summary: List titles
      description: Returns all titles for an organization. Organization members can view titles.
      parameters:
        - in: path
          name: id
          schema: { type: string, format: uuid }
          required: true
      responses:
        "200":
          description: List of titles
          content:
            application/json:
              schema:
                type: object
                properties:
                  titles:
                    type: array
                    items:
                      $ref: "#/components/schemas/Title"
        "400":
          description: Bad request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - User is not an organization member
        "500":
          description: Internal server error
      security:
        - bearerAuth: []

  /organizations/{id}/titles/{titleId}:
    put:
      summary: Update title
      description: Updates an existing title. Only organization owners can update titles.
      parameters:
        - in: path
          name: id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: titleId
          schema: { type: string, format: uuid }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateTitleRequest"
      responses:
        "200":
          description: Title updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  title:
                    $ref: "#/components/schemas/Title"
        "400":
          description: Bad request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - User is not an organization owner
        "404":
          description: Title not found
        "500":
          description: Internal server error
      security:
        - bearerAuth: []

    delete:
      summary: Delete title
      description: Deletes a title. Only organization owners can delete titles.
      parameters:
        - in: path
          name: id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: titleId
          schema: { type: string, format: uuid }
          required: true
      responses:
        "204":
          description: Title deleted
        "400":
          description: Bad request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - User is not an organization owner
        "500":
          description: Internal server error
      security:
        - bearerAuth: []

  /organizations/{id}/integrations:
    post:
      summary: Create integration config
      description: Creates a new integration configuration for an organization. Only organization owners can create integrations.
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIntegrationConfigRequest"
      responses:
        "201":
          description: Integration config created
          content:
            application/json:
              schema:
                type: object
                properties:
                  integration:
                    $ref: "#/components/schemas/IntegrationConfig"
        "400":
          description: Invalid request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - User is not an organization owner
        "500":
          description: Internal server error
      security:
        - bearerAuth: []

    get:
      summary: List integration configs
      description: Returns all integration configurations for an organization. Organization members can view integrations.
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
      responses:
        "200":
          description: List of integration configs
          content:
            application/json:
              schema:
                type: object
                properties:
                  integrations:
                    type: array
                    items:
                      $ref: "#/components/schemas/IntegrationConfig"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - User is not an organization member
        "500":
          description: Internal server error
      security:
        - bearerAuth: []

  /organizations/{id}/integrations/{integrationId}:
    get:
      summary: Get integration config
      description: Returns details about a specific integration configuration. Organization members can view integrations.
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
        - in: path
          name: integrationId
          schema: { type: string }
          required: true
      responses:
        "200":
          description: Integration config details
          content:
            application/json:
              schema:
                type: object
                properties:
                  integration:
                    $ref: "#/components/schemas/IntegrationConfig"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - User is not an organization member
        "404":
          description: Integration config not found
        "500":
          description: Internal server error
      security:
        - bearerAuth: []

    put:
      summary: Update integration config
      description: Updates an existing integration configuration. Only organization owners can update integrations.
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
        - in: path
          name: integrationId
          schema: { type: string }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateIntegrationConfigRequest"
      responses:
        "200":
          description: Integration config updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  integration:
                    $ref: "#/components/schemas/IntegrationConfig"
        "400":
          description: Invalid request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - User is not an organization owner
        "404":
          description: Integration config not found
        "500":
          description: Internal server error
      security:
        - bearerAuth: []

    delete:
      summary: Delete integration config
      description: Deletes an integration configuration. Only organization owners can delete integrations.
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
        - in: path
          name: integrationId
          schema: { type: string }
          required: true
      responses:
        "204":
          description: Integration config deleted
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - User is not an organization owner
        "404":
          description: Integration config not found
        "500":
          description: Internal server error
      security:
        - bearerAuth: []

  /organizations/{id}/source-control-accounts:
    get:
      summary: List organization source control accounts
      description: Returns a list of source control accounts for an organization. Organization members can view source control accounts.
      parameters:
        - in: path
          name: id
          schema: { type: string, format: uuid }
          required: true
          description: Organization ID
      responses:
        "200":
          description: List of source control accounts
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ListOrganizationSourceControlAccountsResponse"
        "400":
          description: Bad request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - User is not an organization member
        "500":
          description: Internal server error
      security:
        - bearerAuth: []

  /organizations/{id}/pull-requests:
    get:
      summary: List organization pull requests
      description: Returns a list of pull requests for an organization. Organization members can view pull requests.
      parameters:
        - in: path
          name: id
          schema: { type: string, format: uuid }
          required: true
          description: Organization ID
        - in: query
          name: userIds
          schema:
            type: array
            items: { type: string }
          description: Optional list of user IDs to filter pull requests by
        - in: query
          name: repositoryName
          schema: { type: string }
          description: Optional repository name to filter pull requests by
        - in: query
          name: startDate
          schema: { type: string, format: date }
          description: Optional start date in format YYYY-MM-DD to filter pull requests by
        - in: query
          name: endDate
          schema: { type: string, format: date }
          description: Optional end date in format YYYY-MM-DD to filter pull requests by
        - in: query
          name: status
          schema:
            type: string
            enum: [open, closed, merged]
          description: Optional status to filter pull requests by (open, closed, or merged)
      responses:
        "200":
          description: List of pull requests
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ListOrganizationPullRequestsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"
      security:
        - bearerAuth: []

  /organizations/{id}/sourcecontrol/metrics:
    get:
      summary: Get organization source control metrics
      description: Retrieves aggregated source control metrics for an organization, optionally filtered by teams
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Organization ID
        - name: startDate
          in: query
          required: false
          schema:
            type: string
            format: date
          description: Start date for filtering (YYYY-MM-DD)
        - name: endDate
          in: query
          required: false
          schema:
            type: string
            format: date
          description: End date for filtering (YYYY-MM-DD)
        - name: interval
          in: query
          required: false
          schema:
            type: string
            enum: [daily, weekly, monthly]
          description: Time interval for graph metrics
        - name: teamIds
          in: query
          required: false
          schema:
            type: array
            items: { type: string }
          description: Optional array of team IDs to filter metrics by
      responses:
        "200":
          description: Organization metrics retrieved successfully. Includes cumulative metrics and optional team breakdown when teams are specified.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrganizationMetricsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"
      security:
        - bearerAuth: []

  /organizations/{id}/members/{memberId}/sourcecontrol/activity:
    get:
      summary: Get member source control activity
      description: Retrieves a timeline of source control activities for a specific member
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Organization ID
        - name: memberId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Member ID
        - name: startDate
          in: query
          required: false
          schema:
            type: string
            format: date
          description: Start date for filtering (YYYY-MM-DD)
        - name: endDate
          in: query
          required: false
          schema:
            type: string
            format: date
          description: End date for filtering (YYYY-MM-DD)
      responses:
        "200":
          description: Member activity timeline retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetMemberActivityResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /organizations/{id}/members/{memberId}/sourcecontrol/metrics:
    get:
      summary: Get member source control metrics
      description: Retrieves source control metrics for a specific member with peer comparison
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Organization ID
        - name: memberId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Member ID
        - name: startDate
          in: query
          required: false
          schema:
            type: string
            format: date
          description: Start date for filtering (YYYY-MM-DD)
        - name: endDate
          in: query
          required: false
          schema:
            type: string
            format: date
          description: End date for filtering (YYYY-MM-DD)
        - name: interval
          in: query
          required: false
          schema:
            type: string
            enum: [daily, weekly, monthly]
          description: Time interval for graph metrics
      responses:
        "200":
          description: Member metrics retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetMemberMetricsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /organizations/{id}/teams:
    get:
      summary: Get all teams for an organization
      description: Returns a list of teams for the specified organization with optional filters
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
          description: Organization ID
        - in: query
          name: name
          schema: { type: string }
          description: Filter teams by name
      responses:
        "200":
          description: List of teams
          content:
            application/json:
              schema:
                type: object
                properties:
                  teams:
                    type: array
                    items:
                      $ref: "#/components/schemas/Team"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"
      security:
        - bearerAuth: []

    post:
      summary: Create team
      description: Creates a new team in an organization
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
          description: Organization ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                description: { type: string }
                type: 
                  type: string
                  enum: [squad, chapter, tribe, guild]
              required:
                - name
      responses:
        "201":
          description: Team created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Team"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"
      security:
        - bearerAuth: []

  /organizations/{id}/teams/{teamId}:
    get:
      summary: Get team by ID
      description: Returns details about a specific team
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
          description: Organization ID
        - in: path
          name: teamId
          schema: { type: string }
          required: true
          description: Team ID
      responses:
        "200":
          description: Team details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Team"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
      security:
        - bearerAuth: []

    put:
      summary: Update team
      description: Updates an existing team's details
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
          description: Organization ID
        - in: path
          name: teamId
          schema: { type: string }
          required: true
          description: Team ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                description: { type: string }
                type: 
                  type: string
                  enum: [squad, chapter, tribe, guild]
      responses:
        "200":
          description: Team updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Team"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
      security:
        - bearerAuth: []

    delete:
      summary: Delete team
      description: Deletes a team
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
          description: Organization ID
        - in: path
          name: teamId
          schema: { type: string }
          required: true
          description: Team ID
      responses:
        "204":
          description: Team deleted
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
      security:
        - bearerAuth: []

  /organizations/{id}/teams/{teamId}/members:
    post:
      summary: Add team member
      description: Adds a user to a team
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
          description: Organization ID
        - in: path
          name: teamId
          schema: { type: string }
          required: true
          description: Team ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                memberId: { type: string }
              required:
                - memberId
      responses:
        "201":
          description: Member added
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
      security:
        - bearerAuth: []

  /organizations/{id}/teams/{teamId}/members/{memberId}:
    delete:
      summary: Remove team member
      description: Removes a user from a team
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
          description: Organization ID
        - in: path
          name: teamId
          schema: { type: string }
          required: true
          description: Team ID
        - in: path
          name: memberId
          schema: { type: string }
          required: true
          description: Member ID
      responses:
        "204":
          description: Member removed
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
      security:
        - bearerAuth: []

  /directs:
    post:
      summary: Create reporting relationship
      description: Create a manager-report link with depth.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                managerId: { type: string }
                reportId: { type: string }
                depth: { type: integer }
      responses:
        "201":
          description: Created
      security:
        - bearerAuth: []

  /source-control-accounts:
    get:
      summary: List source control accounts
      responses:
        "200":
          description: List of accounts
      security:
        - bearerAuth: []

    post:
      summary: Create a source control account
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                userId: { type: string }
                providerName: { type: string }
                providerId: { type: string }
                username: { type: string }
                metadata: { type: object }
      responses:
        "201":
          description: Created
      security:
        - bearerAuth: []

  /pull-requests:
    get:
      summary: List PRs
      responses:
        "200":
          description: List of PRs
      security:
        - bearerAuth: []

    post:
      summary: Create PR record
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                sourceControlAccountId: { type: string }
                providerId: { type: string }
                url: { type: string }
                title: { type: string }
                status: { type: string }
                createdAt: { type: string, format: date-time }
                mergedAt: { type: string, format: date-time }
                lastUpdatedAt: { type: string, format: date-time }
                timeToFirstReview: { type: integer }
                timeToMerge: { type: integer }
      responses:
        "201":
          description: PR Created
      security:
        - bearerAuth: []

  /pull-requests/{id}/comments:
    post:
      summary: Add a PR comment
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                source_countrol_account_id: { type: string }
                body: { type: string }
      responses:
        "201":
          description: Comment created
      security:
        - bearerAuth: []

  /pull-requests/{id}/reviewers:
    post:
      summary: Add a PR reviewer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reviewerId: { type: string }
                reviewedAt: { type: string, format: date-time }
                reviewState: { type: string }
      responses:
        "201":
          description: Reviewer added
      security:
        - bearerAuth: []

  /project-management-accounts:
    get:
      summary: List PM accounts
      responses:
        "200":
          description: List of PM accounts
      security:
        - bearerAuth: []

    post:
      summary: Create PM account
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                userId: { type: string }
                providerName: { type: string }
                providerId: { type: string }
                metadata: { type: object }
      responses:
        "201":
          description: Created
      security:
        - bearerAuth: []

  /pm-tickets:
    get:
      summary: List project tickets
      responses:
        "200":
          description: Ticket list
      security:
        - bearerAuth: []

    post:
      summary: Create PM ticket
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                projectManagementAccountId: { type: string }
                providerId: { type: string }
                title: { type: string }
                epic: { type: string }
                labels:
                  type: array
                  items: { type: string }
                status: { type: string }
                storyPoints: { type: integer }
                createdAt: { type: string, format: date-time }
                updatedAt: { type: string, format: date-time }
                completedAt: { type: string, format: date-time }
      responses:
        "201":
          description: Ticket created
      security:
        - bearerAuth: []
